---
title: "como começar a usar R"
author: "Sara Mortara & Andrea Sánchez-Tapia <br> ¡liibre!"
date: "Instituto HUB - 14.nov.2020"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE, cache = TRUE)

```

```{r xaringanthemer, include = FALSE}
library(xaringanthemer)
library(xaringanExtra)
xaringanthemer::style_mono_accent(
  base_color = "#A70000",
  #  primary_color = "#A70000",
  #secondary_color = "#ff0000",
  white_color = "white",
  colors = c(
    red = "#A70000",
    purple = "#88398a",
    orange = "#ff8811",
    green = "#136f63",
    blue = "#4B4FFF",
    white = "#FFFFFF",
    black = "#181818"
  ),
  header_font_google = google_font("Roboto Condensed"),
  text_font_google   = google_font("Roboto Condensed", "300", "300i"),
  code_font_google   = google_font("Ubuntu Mono"),
  text_font_size = "30px",
  code_font_size = "30px",
  )
```

```{r xaringanExtra-clipboard, echo=FALSE}
htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "<i class=\"fa fa-clipboard\"></i>",
    success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
    error_text = "<i class=\"fa fa-times-circle\" style=\"color: #F94144\"></i>"
  ),
  rmarkdown::html_dependency_font_awesome()
)
```
## apresentação

```{r logo-liibre, echo = FALSE}

xaringanExtra::use_logo(image_url = "https://raw.githubusercontent.com/liibre/logo/master/figures/logo_liibre.png", width = 150)
#knitr::include_graphics("https://raw.githubusercontent.com/liibre/logo/master/figures/logo_liibre.png?token=AA75IFQA34SCCZB72UL5IXK7UWDYA")
```


- __Andrea Sánchez-Tapia__ Bióloga (UNAL - Colômbia), MSc. Ecologia (UFRJ), Dra. em Botânica (ENBT-JBRJ). Usuária de R desde 2009. Ecologia quantitativa, Informática da biodiversidade, Ecologia de comunidades, Ciência de dados feminista
--

- __Sara Ribeiro Mortara__
Bióloga (ESALQ/USP), MSc. Ecologia e Conservação da Biodiversidade (UESC) e Dra. em Ecologia (USP). Usuária de R desde 2009. Modelagem estatística, Ecologia & Ciência de dados feminista
--

- __¡liibre!__ se propõe a criar um ambiente de ensino e aprendizagem de habilidades computacionais a partir de uma perspectiva de ciência de dados feminista, responsável, aberta e para todes.

---
## projetos

- pacotes [coronabr](https://liibre.github.io/coronabr/about.html) , [modleR](https://model-r.github.io/modleR/]modleR), [rocc](https://github.com/liibre/rocc), [dados](https://github.com/cienciadedatos/dados)

- curso de _Projetos de análise de dados usando R_ no Jardim Botânico do Rio de Janeiro

- [**Observatório COVID-19 BR**](https://covid19br.github.io/)

- Capítulo de RLadies+ Rio de Janeiro [**.purple[@RLadiesRio]**](https://twitter.com/RLadiesRio)


```{r logo-rladiesplus, out.width=150, fig.align ='right', echo = FALSE}
knitr::include_graphics("https://raw.githubusercontent.com/rladies/starter-kit/master/stickers/rainbow-inclusive.png")
```

---

## sobre hoje

1. conhecendo a linguagem R e fluxo de trabalho

2. introdução ao R

3. manipulação de dados

4. criando figuras básicas

---

## códigos de apoio

todos os códigos diponíveis em: 

`r icon::fa("github")` https://github.com/liibre/instituto_hub_demo


`r icon::fa("r-project")`  https://rstudio.cloud/project/1878325

---
## antes de começar

+ procure a janela de chat do zoom, e faça perguntas por aí

--

+ tem um botão verde para contar se tudo está certo. Periodicamente vamos perguntar se todo mundo está acompanhando, por favor use este botão ou responda no chat

---
## por que R?

- linguagem de __código aberto__, __livre__ & __sem custo__: um dos pilares da ciência aberta

--

- __baseada em scripts__: essencial para reprodutibilidade, facilidade para ampliar a escala, transparência, correção/robusteza 

--

- acessível (em comparação a outras linguagens de programação)

--

- muito comum na Biologia, Ciência de Dados e outras áreas. A escolha para quem precisa fazer analises estatísticas

--

+ __interdisciplinária e modular__: muitos especialistas escrevem pacotes 

--

+ uma filosofia de passar facilmente do uso à criação (programação)

---
## por que R?

+ ferramentas para __comunicar os resultados__: manuscritos, presentações, _apps_

--

+ comunicação com otras linguagens de programação (ex. python e __reticulate__) 

--

+ ótima capacidade gráfica 

--

+ __suporte oficial__: documentação, vignettes, listas de email

--

+ suporte não oficial: uma comunidade ativa: listas de email, grupos de usuáries (useR), capítulos de .purple[R-Ladies+], comunidade de  [RStudio](community.rstudio.com/) 
Stack Overflow, `r icon::fa("twitter")` `#rstats`

```{r rladies+, out.width=150, echo = FALSE}
knitr::include_graphics("https://raw.githubusercontent.com/rladies/starter-kit/master/stickers/rainbow-inclusive.png")
```

---
## `R` tem uma estrutura modular: __pacotes__
--

+ a instalação de base de `R` inclui pacotes mantidos pelo __`R` Core Development Team__

--

+ repositório oficial de pacotes: __CRAN__ (The Comprehensive `R` Archive Network) or Bioconductor, GitHub, rOpenSci.org

--

+ os pacotes são coleções de __funções__ 

--

+ as funções têm __opções__: "parâmetros", "argumentos"

---
background-image:url("figs/rstudio.png")
background-size: 60%
background-position: 50% 90%

## rodando R em RStudio

+ deszipe o arquivo ZIP, entre na pasta e clique no arquivo __instituto_hub_demo.Rproj__

`r icon::fa("laptop-code", size = 3)`

---
## RStudio 

+ quatro paineis (script, console, várias abas: help, environment, plots, files...)

+ podemos executar código no console mas vamos usar o __script__ para guardar os passos. 

+ escrever no script e clicar `control + enter` para mandar o conteúdo para o console.


---
class: inverse, middle, center
## Configuração e organização de projetos 

---
## pasta de trabalho

+ R tem que saber __em que pasta você está trabalhando__, para poder buscar os arquivos que você quer ler, e saber onde guardar os resultados de suas análises: __working directory__: pasta de trabalho

--

+ para saber onde você está: `getwd()`

--

+ você pode mudar esta localização usando `setwd()` mas não é recomendado (erros!)

--

+ melhor: em vez de abrir RStudio e trocar a pasta, abrir um script de R (extensão `.R`) ou um projeto de __RStudio project__ (extensão `.Rproj`) __já na pasta onde você vai trabalhar__. (Igual ao que você faria abrindo um arquivo `r icon::fa("file-word")`)

---
## organização de projetos e Boas Práticas

+ cada projeto de análise de dados deveria estar em __uma única pasta__

--

+ __subpastas__ para organizar o conteúdo.

--

+ em vez de usar __caminhos absolutos__ é melhor usar __caminhos relativos__
  + evite `C:usuario/seu_nome/suas_pastas/seu_projeto` -> caminho absoluto
  + `.` "aqui" (o resultado de `getwd()`)
  + `./subpastas` (ex. `/figs`)
  + o nível acima `..`
  
--

+ os __dados originais__ não devem ser modificados. qualquer modificação deve ser salva à parte, junto com os scripts que fizeram a modificação.

---
## o projeto atual

```
  .
  ├── README.md
  ├── codigo
  │   ├── 01-intro.R
  │   ├── 02-fluxo_trabalho.R
  │   ├── 03-manipulacao_dados.R
  │   └── 04-graficos.R
* ├── dados
* ├── figuras
* ├── resultados
  └── instituto_hub_demo.Rproj
```

<center>
`r icon::fa("laptop-code", size = 3)`
</center>

---
## os projetos de RStudio

+ arquivos __opcionais__, com extensão __.Rproj__ para abrir a sessão de R no local correto

--

+ um projeto de RStudio pode ser criado clicando no canto superior direito (`Project: none > New project`)

---
class: inverse, middle, center

## introdução a R

`r icon::fa("laptop-code", size = 3)`

---
## criação de objetos e o _workspace_

+ `<-` - para atribuição a objetos

--

+ cria dentro do espaço de trabalho "__workspace__", aba __Environment__ de RStudio

--

+ pode explorar o conteúdo com `ls()` (listar)

--

+ quando você cria objetos eles ocupam memória RAM do computador

--

+ o __workspace__ pode ser salvo e carregado entre sessões mas não é recomendável fazer isto `#boaspráticas`

--

  + você pode perder controle de como foram criados os objetos
  + pode guardar objetos com erros e isto pode interferir no seu trabalho

---
## criação de objetos e o _workspace_


+ confiar no __script__ para recriar todos os objetos

--

+ guardar os objetos importantes como __tabelas__, __figuras__, ou objetos individuais de R (`.rda` ou `.rdata`)

--

+ um script deveria ler ou criar objetos no início e salvar resultados no final

--

+ é bom criar diferentes scripts sucessivos para manter a ordem

---
background-image:url("figs/0a_setup.png")
background-size: 60%
background-position: 60% 100%

.pull-left[
#### nas opções gerais
]


---
## tipos de dados em R

+ R entende dados __numéricos__ (_numeric_, e _integer_ para números inteiros), de __texto__ (_character_), valores lógicos (`TRUE/FALSE`), entre outros.

<small>

```{r vetores}
populacao <- c(1500, 2000) 
estados <- c("Acre", "Alagoas", "Amapá", "Amazonas", "Tocantins")
class(populacao)
class(estados)
```
</small>

---
## tipos de dados em R

<small>

```{r vetores2}
verdadeiro_falso <- c(FALSE, TRUE)
verdadeiro_falso
class(verdadeiro_falso)
posicao <- c(1L, 2L)
posicao
class(posicao)
```
</small>

---
## vetores

+ `c()` para criar - "concatenar"

```{r}
str(estados) #estrutura
length(estados)
```

---
## selecionando elementos de vetores (_subsetting_)

+ entre __colchetes__ `[]`
+ com vetores de __posição__ ou vetores __lógicos__ (`TRUE/FALSE`)


<small>
```{r, results = "hide"}
estados <- c("Acre", "Alagoas", "Amapá", "Amazonas", "Tocantins")
estados[1]
estados[c(TRUE, FALSE, TRUE, FALSE)]
estados[1:2]
estados[1:4]
#estados[ 1,3,5] #NAO! a vírgula marca dimensões
estados[c(1,3,5)] #tem que ser um vetor
```
</small>

---
## subsetting com cláusulas lógicas 

```{r, results="hide"}
casos <- c(150, 200, 400, 500, 500, 600)
casos > 150
casos[casos > 150]
casos >= 150 # superior ou igual
casos < 300
casos == 200
casos != 200
```

---
## operadores lógicos

.pull-left[
+ igualdade: `==`
+ diferença: `!=` (`!` em geral é negação)
+ desigualdades: `<`. `>`, `<=`, `>=`
+ união (OR/OU): `|`
+ interseção (AND): `&`
+ pertenecimento: `%in%`
+ _não_ pertenecimento: `!a %in% b`
]

.pull-right[
+ `casos == 200`
+ `casos != 200`
+ `casos < 300`, `casos >= 150`
+ `casos < 200 | casos > 500`
+ `casos > 200 & casos < 500`
+ `casos %in% c(100, 200, 300)`
+ `!casos %in% c(400)`
]

O operador lógico cria um __vetor lógico__, a seleção vai entre colchetes:

```{r}
casos[casos > 150]
```

---
## comparando vetores

<small>
```{r pertenecimento}
estados <- c("acre", "alagoas", "amapá", "amazonas")
norte <- c("acre", "amapá", "amazonas", "pará", "rondônia",
           "roraima" , "tocantins")

estados %in% norte
estados[estados %in% norte]

```

---
## comparando vetores

<small>
```{r reciclando, results="hide", warning=F}

estados == norte
estados[estados == norte] #por que só tem acre?

```
</small>

+ Os vetores são comparados __elemento por elemento__ e __reciclados__ quando um deles é mais curto. Possivelmente você está tentando usar `%in%` para checar se os elementos pertencem ao outro conjunto.


---
##  outras funções importantes

```{r, results="hide"}
1:10
seq(1, 10, 2)
rep(1:4, 2)
rep(1:4, each = 2)
unique(casos)
```

---
## estruturas de dados em `R`

+ __vetor__: lineal, uma dimensão só: `length()`

--

+ __fatores__: vetores  que representam __variáveis categóricas__ e portanto têm níveis (__levels()__)

--

+ __matrizes__: arranjos de duas dimensões de __dados do mesmo tipo__ (`dim()`, `nrow()`, `ncol()`). __Em R sempre linhas primeiro, colunas depois__

--

+ __data frames__: arranjos bi-dimensionais de dados de diferentes tipos (i.e., uma coluna numérica, outra com nomes, outra com um fator etc.)

--

+ __listas__: literalmente listas de qualquer outro objeto (inclusive listas) 

--

__Hoje: data.frames__


---
## instalando pacotes

```{r, eval = F}
# Para instalar pacotes
install.packages("remotes")

# Para instalar coronabr
remotes::install_github("liibre/coronabr")

# Para carregar pacotes
library(coronabr)

# Para buscar ajuda
?coronabr
```

---
## funções, argumentos e entendendo a ajuda

.pull-left[
```
help(funcao)
?funcao
??palavra_chave
args(funcao)
```
]

.pull-right[
```r
help("get_corona_br")
?get_corona_br
??corona
args(get_corona_br)
```
]

+ ou selecionar o nome da função e clicar __F1__

+ No __help__ estão os argumentos na ordem correta, e os valores padrão (por _default_) estão indicados. Se a gente não especificasse a função usaria esses valores.  

---
## download dos dados para Amapá

+ Criar pasta à mão ou usar `dir.create()`

```{r, echo = FALSE}
library(coronabr)
```

```{r}
caminho <- "dados/brutos"  #poderia ser "./dados/brutos"
dir.create(path = caminho, recursive = TRUE)
amapa <- get_corona_br(dir = caminho, filename = "01-amapa", uf = "AP")
```

---
## data frames 

+ Duas dimensões (linhas e colunas): `dim()`, `ncol()`, `nrow()`

+ Em R sempre primeiro linhas, logo colunas. 

+ Podem ser diferentes tipos de dado

+ Idealmente: __uma linha por observação__, __uma coluna por variável__

---
## inspecionar objetos `data.frame`

```{r try, echo = TRUE, eval = FALSE}
names(amapa)
dim(amapa)
nrow(amapa)
ncol(amapa)
head(amapa) # 6 linhas por defeito
tail(amapa)
rownames(amapa)
length(amapa) # numero de colunas
summary(amapa) # quantis e a média 
```

---
## selecionar colunas e filtrar linhas

+ entre colchetes também mas __as dimensões separadas por uma vírgula__

`amapa[linhas, colunas]`

```{r}
amapa[,1:3] #três primeiras colunas
amapa[4,13] #quarto elemento da coluna 13

```

---
## Outras fontes de ajuda

+ Taskviews 

[https://cran.r-project.org/web/views/](https://cran.r-project.org/web/views/)


---

# Obrigada!

<center>
`r icon::fa("paper-plane")` [andreasancheztapia@gmail.com](mailto:andreasancheztapia@gmail.com) [saramortara@gmail.com](mailto:saramortara@gmail.com) 

`r icon::fa("twitter")` [@SanchezTapiaA](https://twitter.com/SanchezTapiaA)  [@MortaraSara](https://twitter.com/MortaraSara) 

`r icon::fa("github")` `r icon::fa("gitlab")` [¡liibre!](http://github.com/liibre)  
